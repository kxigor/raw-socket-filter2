# Raw Socket Packet Intercept Pipeline (R-SPID)

## Project Description

**R-SPID** is a custom network utility written in C, designed to intercept, modify, and respond to raw network packets at the data link layer. It functions as a generic, application-level packet filter and forwarder, demonstrating complex network manipulation techniques.

The "Trauma Tracer" functionality (ICMP/DNS Deception with lyrics) is a specific, narrative-driven implementation built on top of this flexible pipeline.

The architecture is split into two core components:

1.  **`raw_socket_forwarder` (Core Pipeline):** A generic, reusable library for setting up raw packet listening sockets on two interfaces, managing a multi-threaded processing pipeline, and handling packet forwarding, modification, or answering based on a configuration.
2.  **`trace_deceptor` (Application Logic):** The specific filter implementation that leverages the `raw_socket_forwarder` to detect `traceroute` probes destined for designated "spoofed" IPs and craft custom ICMP Time Exceeded responses that contain narrative data ("trauma lyrics") in place of standard hostname resolution.

The final effect, when running the `trace_deceptor` example, is a highly unusual `traceroute` output that tells a story, making the network appear to be responding with existential dread.

## Core Architecture

The system operates using a defined pipeline based on the `raw_forwarder_config_t` structure. This structure allows for highly customized packet handling:

| Component | Responsibility | Status Returned | Action Taken |
| :--- | :--- | :--- | :--- |
| **`filter` function** | Analyzes the input packet (`Packet input`) to determine the necessary action. | **ACCEPT** | Forward packet unchanged to the destination interface. |
| | | **DROP** | Discard the packet. |
| | | **MODIFY** | Calls the `modify` function, then sends the result to the destination interface. |
| | | **ANSWER** | Calls the `answer` function, then sends the result **back to the source** interface. |
| **`modify` function** | Alters the packet's content (e.g., headers, payload) for forwarding. | | The resulting modified packet is sent to the destination interface. |
| **`answer` function** | Generates a completely new response packet (e.g., a spoofed ICMP message). | | The response is sent back to the originator. |
| **`cleanup` function** | Handles memory management for packets generated by `modify` or `answer`. | | Frees buffer memory after send completion. |

This modular design allows the `raw_socket_forwarder` to be used for any kind of raw packet manipulation (e.g., mirroring, logging, firewalling, or deception).

## Features

  * **Raw Socket Traffic Handling:** Utilizes raw sockets (`PF_PACKET`/`AF_PACKET`) for low-level access to Ethernet frames.
  * **Decoupled Logic:** Separation of the generic packet pipeline (`raw_socket_forwarder`) from the specific application logic (`trace_deceptor`).
  * **Powerful Modification Hook:** Includes the capability to **`MODIFY`** packets in transit for man-in-the-middle operations.
  * **ICMP/DNS Deception:** Specifically intercepts and fabricates responses to `traceroute` (ICMP Time Exceeded) probes.
  * **Narrative Injection:** Replaces standard network resolution responses with lines of the "Trauma" narrative.
  * **Threaded Processing:** Uses separate threads for packet filtering and passing to ensure non-blocking operation.
  * **Customizable Targets:** Easily define the list of target IP addresses and the injected content in `trauma_app.h`.

## Usage

### Build and Run

The project uses CMake for building (requires `cmake` and standard Linux networking development headers).

1.  **Build:**

    ```bash
    ./runbuild.sh
    ```

2.  **Run (Requires Root/Sudo):**
    The utility must run with sufficient privileges to use raw sockets.

    ```bash
    # Default: source=eth0, dest=eth1
    sudo ./build/app/trauma_app 

    # Or specify interfaces
    sudo ./build/app/trauma_app -s veth0 -d veth1
    ```

3.  **Stop:**
    Press `Enter` in the terminal where the tool is running.

### Example Deception

When the filter is running and a user performs a `traceroute` to one of the configured spoofed IP addresses (e.g., `42.42.42.42`), the output is completely hijacked by the application, substituting hostnames with the lyrics:

```shell
/ # traceroute -m 60 66.66.66.66
traceroute to 66.66.66.66 (66.66.66.66), 60 hops max, 46 byte packets
 1  Years.kept.passing.by (11.22.33.1)  0.251 ms  Still.my.mind.hasn-t.forgotten (11.22.33.2)  0.305 ms  Corpses.lying.among.debris (11.22.33.3)  0.270 ms
 2  Unrecognizable.rotten (11.22.33.4)  0.318 ms  Suffering.from.a.trauma (11.22.33.5)  0.069 ms  It.keeps.haunting.me (11.22.33.6)  0.134 ms
 3  Considering.me.an.obsessional (11.22.33.7)  0.233 ms  But.they.will.never.know (11.22.33.8)  0.088 ms  The.massacres.in.former.days (11.22.33.9)  0.124 ms
 4  Hatred.won-t.let.go (11.22.33.10)  0.259 ms  Nightmares.controlling.my.life (11.22.33.11)  0.197 ms  In.my.own.world.I.live (11.22.33.12)  0.822 ms
 5  Suffer.day.and.night (11.22.33.13)  0.318 ms  I.face.pain.I.don-t.want.to.see (11.22.33.14)  0.106 ms  Makes.me.realize (11.22.33.15)  0.158 ms
 6  It.won-t.leave.me (11.22.33.16)  0.137 ms  Horrible.events.pass.me.by (11.22.33.17)  0.208 ms  I.wake.from.my.cry (11.22.33.18)  0.200 ms
 7  In.the.middle.of.the.night (11.22.33.19)  0.248 ms  I.find.myself.shuddering.in.sweat (11.22.33.20)  0.268 ms  Memories.of.sorrow.and.death (11.22.33.21)  0.268 ms
 8  Nightmares.controlling.my.life (11.22.33.22)  0.322 ms  Trauma (11.22.33.23)  0.098 ms  Horrible.events.pass.me.by (11.22.33.24)  0.052 ms
 9  Trauma (11.22.33.25)  0.051 ms  Bodies.filled.with.lead (11.22.33.26)  0.053 ms  They.all.have.met.an.untimely.death (11.22.33.27)  0.001 ms
10  Blood.was.everywhere (11.22.33.28)  0.155 ms  They.lived.in.chaos.and.despair (11.22.33.29)  0.087 ms  I.suffer.day.and.night (11.22.33.30)  0.174 ms
11  Trauma (11.22.33.31)  0.082 ms  I.wake.from.my.cries (11.22.33.32)  0.137 ms  Trauma (11.22.33.33)  0.076 ms
12  Considering.me.an.obsessional (11.22.33.34)  0.133 ms  But.they.will.never.know (11.22.33.35)  0.265 ms  The.massacres.in.former.days (11.22.33.1)  0.223 ms
13  Hatred.won-t.let.go (11.22.33.2)  0.073 ms  Years.kept.passing.by (11.22.33.3)  0.199 ms  Still.my.mind.hasn-t.forgotten (11.22.33.4)  0.140 ms
14  Corpses.lying.among.debris (11.22.33.5)  0.093 ms  Unrecognizable.rotten (11.22.33.6)  0.204 ms  Suffering.from.a.trauma (11.22.33.7)  0.300 ms
15  It.keeps.haunting.me (11.22.33.8)  0.262 ms  Considering.me.an.obsessional (11.22.33.9)  0.889 ms  But.they.will.never.know (11.22.33.10)  0.076 ms
16  The.massacres.in.former.days (11.22.33.11)  0.094 ms  Hatred.won-t.let.go (11.22.33.12)  0.207 ms  Nightmares.controlling.my.life (11.22.33.13)  0.106 ms
17  In.my.own.world.I.live (11.22.33.14)  0.068 ms  Suffer.day.and.night (11.22.33.15)  0.194 ms  I.face.pain.I.don-t.want.to.see (11.22.33.16)  0.146 ms
18  Makes.me.realize (11.22.33.17)  1.026 ms  It.won-t.leave.me (11.22.33.18)  0.146 ms  Horrible.events.pass.me.by (11.22.33.19)  0.060 ms
19  I.wake.from.my.cry (11.22.33.20)  0.027 ms  In.the.middle.of.the.night (11.22.33.21)  0.319 ms  I.find.myself.shuddering.in.sweat (11.22.33.22)  0.334 ms
20  Memories.of.sorrow.and.death (11.22.33.23)  0.157 ms  Nightmares.controlling.my.life (11.22.33.24)  0.225 ms  Trauma (11.22.33.25)  0.137 ms
21  Horrible.events.pass.me.by (11.22.33.26)  0.185 ms  Trauma (11.22.33.27)  0.241 ms  Bodies.filled.with.lead (11.22.33.28)  0.239 ms
22  They.all.have.met.an.untimely.death (11.22.33.29)  0.148 ms  Blood.was.everywhere (11.22.33.30)  0.931 ms  They.lived.in.chaos.and.despair (11.22.33.31)  0.077 ms
23  I.suffer.day.and.night (11.22.33.32)  0.096 ms  Trauma (11.22.33.33)  0.193 ms  I.wake.from.my.cries (11.22.33.34)  0.170 ms
24  Trauma (11.22.33.35)  0.180 ms  Considering.me.an.obsessional (11.22.33.1)  0.211 ms  But.they.will.never.know (11.22.33.2)  0.234 ms
25  The.massacres.in.former.days (11.22.33.3)  0.118 ms  Hatred.won-t.let.go (11.22.33.4)  0.179 ms  Years.kept.passing.by (11.22.33.5)  0.216 ms
26  Still.my.mind.hasn-t.forgotten (11.22.33.6)  0.175 ms  Corpses.lying.among.debris (11.22.33.7)  0.093 ms  Unrecognizable.rotten (11.22.33.8)  0.235 ms
27  Suffering.from.a.trauma (11.22.33.9)  0.110 ms  It.keeps.haunting.me (11.22.33.10)  0.175 ms  Considering.me.an.obsessional (11.22.33.11)  0.149 ms
28  But.they.will.never.know (11.22.33.12)  0.119 ms  The.massacres.in.former.days (11.22.33.13)  0.217 ms  Hatred.won-t.let.go (11.22.33.14)  0.201 ms
29  Nightmares.controlling.my.life (11.22.33.15)  0.117 ms  In.my.own.world.I.live (11.22.33.16)  0.113 ms  Suffer.day.and.night (11.22.33.17)  0.160 ms
30  I.face.pain.I.don-t.want.to.see (11.22.33.18)  0.068 ms  Makes.me.realize (11.22.33.19)  0.235 ms  It.won-t.leave.me (11.22.33.20)  0.146 ms
31  Horrible.events.pass.me.by (11.22.33.21)  0.405 ms  I.wake.from.my.cry (11.22.33.22)  0.229 ms  In.the.middle.of.the.night (11.22.33.23)  0.108 ms
32  I.find.myself.shuddering.in.sweat (11.22.33.24)  0.730 ms  Memories.of.sorrow.and.death (11.22.33.25)  0.093 ms  Nightmares.controlling.my.life (11.22.33.26)  0.141 ms
33  Trauma (11.22.33.27)  0.238 ms  Horrible.events.pass.me.by (11.22.33.28)  0.110 ms  Trauma (11.22.33.29)  0.164 ms
34  Bodies.filled.with.lead (11.22.33.30)  0.467 ms  They.all.have.met.an.untimely.death (11.22.33.31)  0.145 ms  Blood.was.everywhere (11.22.33.32)  0.093 ms
35  They.lived.in.chaos.and.despair (11.22.33.33)  0.160 ms  I.suffer.day.and.night (11.22.33.34)  0.096 ms  Trauma (11.22.33.35)  0.173 ms
36  I.wake.from.my.cries (11.22.33.1)  0.150 ms  Trauma (11.22.33.2)  0.172 ms  Considering.me.an.obsessional (11.22.33.3)  0.285 ms
37  But.they.will.never.know (11.22.33.4)  0.242 ms  The.massacres.in.former.days (11.22.33.5)  0.295 ms  Hatred.won-t.let.go (11.22.33.6)  0.254 ms
38  Years.kept.passing.by (11.22.33.7)  0.232 ms  Still.my.mind.hasn-t.forgotten (11.22.33.8)  0.102 ms  Corpses.lying.among.debris (11.22.33.9)  0.133 ms
39  Unrecognizable.rotten (11.22.33.10)  0.043 ms  Suffering.from.a.trauma (11.22.33.11)  0.054 ms  It.keeps.haunting.me (11.22.33.12)  0.207 ms
40  Considering.me.an.obsessional (11.22.33.13)  0.118 ms  But.they.will.never.know (11.22.33.14)  0.101 ms  The.massacres.in.former.days (11.22.33.15)  0.110 ms
41  Hatred.won-t.let.go (11.22.33.16)  0.111 ms  Nightmares.controlling.my.life (11.22.33.17)  0.228 ms  In.my.own.world.I.live (11.22.33.18)  0.132 ms
42  Suffer.day.and.night (11.22.33.19)  0.234 ms  I.face.pain.I.don-t.want.to.see (11.22.33.20)  0.407 ms  Makes.me.realize (11.22.33.21)  0.157 ms
43  It.won-t.leave.me (11.22.33.22)  0.130 ms  Horrible.events.pass.me.by (11.22.33.23)  0.230 ms  I.wake.from.my.cry (11.22.33.24)  0.228 ms
44  In.the.middle.of.the.night (11.22.33.25)  0.137 ms  I.find.myself.shuddering.in.sweat (11.22.33.26)  0.093 ms  Memories.of.sorrow.and.death (11.22.33.27)  0.086 ms
45  Nightmares.controlling.my.life (11.22.33.28)  0.081 ms  Trauma (11.22.33.29)  0.232 ms  Horrible.events.pass.me.by (11.22.33.30)  0.121 ms
46  Trauma (11.22.33.31)  0.099 ms  Bodies.filled.with.lead (11.22.33.32)  0.118 ms  They.all.have.met.an.untimely.death (11.22.33.33)  0.132 ms
47  Blood.was.everywhere (11.22.33.34)  0.278 ms  They.lived.in.chaos.and.despair (11.22.33.35)  0.329 ms  I.suffer.day.and.night (11.22.33.1)  0.120 ms
48  Trauma (11.22.33.2)  0.310 ms  I.wake.from.my.cries (11.22.33.3)  0.173 ms  Trauma (11.22.33.4)  0.116 ms
49  Considering.me.an.obsessional (11.22.33.5)  0.267 ms  But.they.will.never.know (11.22.33.6)  0.230 ms  The.massacres.in.former.days (11.22.33.7)  0.197 ms
50  Hatred.won-t.let.go (11.22.33.8)  0.067 ms  Years.kept.passing.by (11.22.33.9)  0.186 ms  Still.my.mind.hasn-t.forgotten (11.22.33.10)  0.215 ms
51  Corpses.lying.among.debris (11.22.33.11)  0.134 ms  Unrecognizable.rotten (11.22.33.12)  0.115 ms  Suffering.from.a.trauma (11.22.33.13)  0.325 ms
52  It.keeps.haunting.me (11.22.33.14)  0.059 ms  Considering.me.an.obsessional (11.22.33.15)  0.085 ms  But.they.will.never.know (11.22.33.16)  0.089 ms
53  The.massacres.in.former.days (11.22.33.17)  0.128 ms  Hatred.won-t.let.go (11.22.33.18)  0.111 ms  Nightmares.controlling.my.life (11.22.33.19)  0.242 ms
54  In.my.own.world.I.live (11.22.33.20)  0.806 ms  Suffer.day.and.night (11.22.33.21)  0.113 ms  I.face.pain.I.don-t.want.to.see (11.22.33.22)  0.130 ms
55  Makes.me.realize (11.22.33.23)  0.400 ms  It.won-t.leave.me (11.22.33.24)  0.256 ms  Horrible.events.pass.me.by (11.22.33.25)  0.248 ms
56  I.wake.from.my.cry (11.22.33.26)  0.384 ms  In.the.middle.of.the.night (11.22.33.27)  0.304 ms  I.find.myself.shuddering.in.sweat (11.22.33.28)  0.292 ms
57  Memories.of.sorrow.and.death (11.22.33.29)  0.139 ms  Nightmares.controlling.my.life (11.22.33.30)  0.237 ms  Trauma (11.22.33.31)  0.264 ms
58  Horrible.events.pass.me.by (11.22.33.32)  0.099 ms  Trauma (11.22.33.33)  0.137 ms  Bodies.filled.with.lead (11.22.33.34)  0.211 ms
59  They.all.have.met.an.untimely.death (11.22.33.35)  0.059 ms  Blood.was.everywhere (11.22.33.1)  0.147 ms  They.lived.in.chaos.and.despair (11.22.33.2)  0.102 ms
60  I.suffer.day.and.night (11.22.33.3)  0.256 ms  Trauma (11.22.33.4)  0.073 ms  I.wake.from.my.cries (11.22.33.5)  0.075 ms
```

## ⚠️ Legal & Ethical Notice

This tool is designed for:
- Educational purposes on authorized networks
- Security research with proper permissions  
- Understanding network packet manipulation

**Warning:** Unauthorized use on networks you don't own may violate laws and terms of service. Use responsibly.